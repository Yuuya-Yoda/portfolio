<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="Yuyaのポートフォリオ兼ブログページです。" />
  <title>Import Yuya</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Material+Icons+Outlined" rel="stylesheet">
  <link rel="shortcut icon" href="../../img/YPP_logo.png" />
  <link rel=”canonical” href=”https://www.~/” />
  <link rel="manifest" href="manifest.webmanifest" />
  <style>
    h1 {
      margin-top: 5px;
      margin-bottom: 5px;
      text-align: center;
    }

    #container {
      position: relative;
      width: 100%;
      max-width: 600px;
      margin: auto;
    }
    .aspect-ratio-box {
      width: 100%;
      position: relative;
      padding-top: 133.33%; /* 3:4の縦横比 */
    }
    .aspect-ratio-box video,
    .aspect-ratio-box canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    #innerVideo {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 100px;
      border: 2px solid white;
    }
    #photoContainer {
      position: relative;
      width: 100%;
      max-width: 600px;
      margin: 20px auto;
    }
    #innerPhoto {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 100px;
      border: 2px solid white;
    }
    #message {
      margin: 20px auto;
      padding: 10px;
      border: 1px solid #ccc;
      background-color: #f8f8f8;
      width: calc(100% - 40px);
      max-width: 600px;
      text-align: center;
    }
  </style>
</head>

<body>
  <h1>WeRealCamera</h1>

  <div id="message">カメラのアクセス状況: 確認中...</div>
  <div id="container">
    <div class="aspect-ratio-box">
      <video id="outerVideo" autoplay></video>
    </div>
    <video id="innerVideo" autoplay muted></video>
  </div>
  <button id="captureButton">写真を撮る</button>
  <div id="photoContainer">
    <div class="aspect-ratio-box">
      <canvas id="outerPhoto"></canvas>
    </div>
    <canvas id="innerPhoto"></canvas>
  </div>

  <script>
    const outerVideo = document.getElementById('outerVideo');
    const innerVideo = document.getElementById('innerVideo');
    const captureButton = document.getElementById('captureButton');
    const outerPhoto = document.getElementById('outerPhoto');
    const innerPhoto = document.getElementById('innerPhoto');
    const messageElement = document.getElementById('message');
    let outerStream;
    let innerStream;

    async function startCameras() {
      let outerSuccess = false;
      let innerSuccess = false;

      try {
        outerStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
        outerVideo.srcObject = outerStream;
        outerSuccess = true;
      } catch (error) {
        console.error('バックカメラのアクセスに失敗しました:', error);
      }

      try {
        innerStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });
        innerVideo.srcObject = innerStream;
        innerSuccess = true;
      } catch (error) {
        console.error('フロントカメラのアクセスに失敗しました:', error);
      }

      if (outerSuccess && innerSuccess) {
        messageElement.textContent = 'カメラのアクセスに成功しました。';
      } else if (outerSuccess) {
        messageElement.textContent = 'バックカメラのアクセスに成功しましたが、フロントカメラのアクセスに失敗しました。';
      } else if (innerSuccess) {
        messageElement.textContent = 'フロントカメラのアクセスに成功しましたが、バックカメラのアクセスに失敗しました。';
      } else {
        messageElement.textContent = 'カメラのアクセスに失敗しました。';
      }
    }

    captureButton.addEventListener('click', () => {
      capturePhoto();
    });

    function capturePhoto() {
      const outerContext = outerPhoto.getContext('2d');
      const innerContext = innerPhoto.getContext('2d');

      // 外カメラの写真を3:4に切り取る
      const outerWidth = outerVideo.videoWidth;
      const outerHeight = outerVideo.videoHeight;
      const outerAspect = 3 / 4;
      
      let newOuterWidth, newOuterHeight;
      if (outerWidth / outerHeight > outerAspect) {
        newOuterHeight = outerHeight;
        newOuterWidth = outerHeight * outerAspect;
      } else {
        newOuterWidth = outerWidth;
        newOuterHeight = outerWidth / outerAspect;
      }

      const outerXOffset = (outerWidth - newOuterWidth) / 2;
      const outerYOffset = (outerHeight - newOuterHeight) / 2;

      outerPhoto.width = newOuterWidth;
      outerPhoto.height = newOuterHeight;
      outerContext.drawImage(outerVideo, outerXOffset, outerYOffset, newOuterWidth, newOuterHeight, 0, 0, newOuterWidth, newOuterHeight);

      // 内カメラの写真をそのまま使用（例として、縦横比は気にしない）
      innerPhoto.width = innerVideo.videoWidth;
      innerPhoto.height = innerVideo.videoHeight;
      innerContext.drawImage(innerVideo, 0, 0, innerPhoto.width, innerPhoto.height);
    }

    // カメラを起動
    startCameras();
  </script>
</body>
</html>
